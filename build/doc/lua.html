<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Ipelib: Programming in Lua</title>
<link href="tabs.css" rel="stylesheet" type="text/css">
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.8 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">The Ipe library documentation</a>
  </div>
</div>
<div class="contents">
<h1><a class="anchor" name="lua">Programming in Lua </a></h1>The library <em>libipelua</em> implements Lua bindings for many classes in Ipelib. If it is installed properly, it should suffice to say <div class="fragment"><pre class="fragment">
require "ipe"
</pre></div> in Lua to make use of these bindings.<p>
These pages document the Lua bindings to Ipelib:<p>
<ul>
<li><a class="el" href="luageo.html">Lua bindings for geometric objects</a> </li>
<li><a class="el" href="luaobj.html">Lua bindings for objects and attributes</a> </li>
<li><a class="el" href="luapage.html">Lua bindings for Document, Page, and StyleSheet</a></li>
</ul>
When writing Ipelets in Lua, you have access to additional methods provided by the Ipe program itself:<p>
<ul>
<li><a class="el" href="luaipe.html">Lua bindings for Ipe</a> </li>
<li><a class="el" href="luaipeui.html">Lua bindings for dialogs and menus</a></li>
</ul>
<h2><a class="anchor" name="luaex">
Examples</a></h2>
Here is a Lua script that reads an Ipe document and then recenters each page on the paper:<p>
<div class="fragment"><pre class="fragment">-- recenter.lua
-- center objects on each page of the document

require "ipe"

inname, outname = ...

if not outname then
  io.stderr.write("Usage: recenter.lua &lt;inputfile&gt; &lt;outputfile&gt;\n")
  return
end

doc = assert(ipe.Document(inname))

-- make sure we have size information for text
assert(doc:runLatex())

layout = doc:styleSheet():find("layout")
fs = layout.framesize

for i,p in doc:pages() do
  box = ipe.Rect()
  for j = 1,#p do
    box:add(p:bbox(j))
  end
  nx = (fs.x - box:width()) / 2
  ny = (fs.y - box:height()) / 2
  trans = ipe.Vector(nx, ny) - box:bottomLeft()
  m = ipe.Translation(trans)
  for j = 1,#p do
    p:transform(j, m)
  end
end
doc:save(outname)

</pre></div><p>
Here is a small Lua script that takes an Ipe document and exports each view separately in EPS format:<p>
<div class="fragment"><pre class="fragment">-- splitviews.lua
-- export each view of an Ipe document separately

require "ipe"

fname = ...
if not fname then
  io.stderr:write("Usage: splitviews.lua &lt;file&gt;\n")
  return
end

i = fname:find("%.[^.]+$")
if i then
  epsname = fname:sub(1,i-1)
else
  epsname = fname
end

doc = assert(ipe.Document(fname))

-- need latex information to save as Postscript
assert(doc:runLatex())

for i,p in doc:pages() do
  io.stderr:write("Saving page " .. i .. "\n") 
  for j = 1, p:countViews() do
    out = epsname .. "-" .. i .. "-" .. j .. ".eps"
    io.stderr:write("Saving view " .. i .. "-" .. j .. " as " .. out .. "\n") 
    doc:exportView(out, "eps", nil, i, j)
  end
end

</pre></div> </div>
<hr>
</body></html>
