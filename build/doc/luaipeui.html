<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ipelib: Lua bindings for dialogs and menus</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="index.html">The Ipe library documentation</a>&nbsp;&raquo&nbsp;<a class="el" href="lua.html">Programming in Lua</a>
  </div>
</div>
<div class="contents">


<h1><a class="anchor" id="luaipeui">Lua bindings for dialogs and menus </a></h1><p>The ipeui module provides dialogs and popup menus for Lua. It does not depend on any other Ipe component, and can be reused in other Lua projects.</p>
<h2><a class="anchor" id="luaipeuiglobal">
Global methods</a></h2>
<p>There are a few global methods in the ipeui module: </p>
<div class="fragment"><pre class="fragment">
ipeui.mainLoop()          -- start event loop
ipeui.closeAllWindows()   -- sends all windows a close event
ipeui.startBrowser(url)   -- on Windows platform only
ipeui.setClipboard(text)  -- store text on system clipboard
text = ipeui.clipboard()  -- get text property from system clipboard
</pre></div><h2><a class="anchor" id="luaipeuipredialogs">
Predefined dialogs</a></h2>
<p>The following are predefined dialogs. In all cases, <code>parent</code> can either be <code>nil</code> or an Appui object.</p>
<div class="fragment"><pre class="fragment">
-- request a string input from user
-- returns string or nil if cancelled
response = ipeui.getString(parent, prompt)

-- get a filename from user
-- type is "open" or "save"
-- filter e.g. "XML (*.xml);;PDF (*.pdf)"
-- dir is nil or a starting directory
-- selected is nil or the filter originally selected
-- returns nil if the dialog is canceled
-- or filename and selected filter
ipeui.fileDialog(parent, type, caption, filter, dir, selected)

-- show a message box
-- type is one of "none" "warning" "information" "question" "critical"
-- details may be nil
-- buttons may be nil (for "ok") or one of 
-- "ok" "okcancel" "yesnocancel", "discardcancel", "savediscardcancel", 
-- return 1 for ok/yes/save, 0 for no/discard, -1 for cancel
ipeui.messageBox(parent, type, text, details, buttons)

-- this dialog only returns when the external editor has finished
ipeui.WaitDialog(parent, command)
</pre></div><h2><a class="anchor" id="luaipeuidialogs">
Dialogs</a></h2>
<p>Other dialogs can be constructed programmatically: </p>
<div class="fragment"><pre class="fragment">
d = ipeui.Dialog(parent, window_title)

d:setStretch("row", row_number, stretch_factor)
d:setStretch("column", row_number, stretch_factor)
d:add(name, what, options, row, column, row_span, column_span)
d:set(name, value)
value = d:get(name)

-- returns true if dialog was accepted
d:execute()
d:execute(size)   -- where size == { width, height }
</pre></div><p><em>name</em> can be an arbitrary string. <em>what</em> must be one of </p>
<div class="fragment"><pre class="fragment">
button, text, list, label, combo, checkbox, input
</pre></div><p> <em>options</em> is a table. Most fields are optional: </p>
<div class="fragment"><pre class="fragment">
-- button:
label="string"  (Required!)
action="accept" or "reject" or a Lua method

-- label:
label="string"  (Required!)

-- text:
read_only=bool
syntax="logfile" or "xml" or "latex"

-- list and combo:
array of list items (strings)

-- checkbox:
label="string"  (Required!)
action= Lua method  (called when state changed)

-- input:
</pre></div><p>The argument of <em>set</em> is: </p>
<ul>
<li>a string value for <em>label</em>, <em>text</em>, and <em>input</em>, </li>
<li>a either an integer or an array of string items for <em>list</em> and <em>combo</em>, </li>
<li>a boolean for <em>checkbox</em>.</li>
</ul>
<p>The result value of <em>get</em> is: </p>
<ul>
<li>a string for <em>text</em> and <em>input</em>, </li>
<li>an integer for <em>list</em> (or nil if there is no current item) or <em>combo</em>, </li>
<li>a boolean for <em>checkbox</em>.</li>
</ul>
<h2><a class="anchor" id="luaipeuimenus">
Popup menus</a></h2>
<p>Popup menus are constructed and shown as follows: </p>
<div class="fragment"><pre class="fragment">
m = ipeui.Menu()	
item, no, subitem = m:execute(global_position)
</pre></div><p> When the menu is cancelled, <em>execute</em> returns <em>nil</em>.</p>
<p>You can then add items to the menu one by one. A simple item is added like this: </p>
<div class="fragment"><pre class="fragment">
m:add("name", "Label")
</pre></div><p> When this item is selected, execute returns <em>name</em>, 0, and an empty string.</p>
<p>The following line adds an entire submenu: </p>
<div class="fragment"><pre class="fragment">
m:add("name", "Submenu", { "alpha", "beta", "gamma" } )
</pre></div><p> When an item from this submenu is selected, <em>execute</em> returns <em>name</em>, the index into the submenu, and the name of the submenu item.</p>
<p>When the strings in the table are not directly the visible labels for the submenu, a Lua function can be used to convert them: </p>
<div class="fragment"><pre class="fragment">
m:add("name", "Submenu", { "alpha", "beta", "gamma" },
      function (i, item) return "select " .. item end )
</pre></div><p>The final argument can either be a string or a function. If it is a string, then all items are checkable, and the item whose name is identical to the final argument is checked. Otherwise, the function maps item number and name to a color (three numbers in the range 0.0 to 1.0). This is then used to display a color icon.</p>
<h2><a class="anchor" id="luaipeuitimers">
Timers</a></h2>
<p>Timers are constructed as follows: </p>
<div class="fragment"><pre class="fragment">
t = ipeui.Timer(parent, table, "method")
</pre></div><p> When the timer times out, it will call the method named <em>method</em> in the Lua table <em>table</em>. The timer stores only a weak reference to the table, so the timer will not stop the table from being garbage collected.</p>
<p>The timer is controlled using the methods: </p>
<div class="fragment"><pre class="fragment">
timer:setInterval(interval)     -- an integer in milliseconds
timer:setSingleShot(bool)
timer:start()	
timer:stop()
a = timer:active()              -- true if the timer is running
</pre></div> </div>
<hr>
</body></html>
